<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Encrypted Token Gist Chat</title>
<style>
body { font-family: Arial; background:#f7f7f8; }
#chat { white-space: pre-wrap; background:#eee; padding:10px; border-radius:8px; min-height:200px; }
textarea { width:100%; height:80px; }
button { padding:8px 14px; margin-top:6px; }
</style>
</head>
<body>

<h2>Encrypted Token Chat</h2>
<div id="chat">Loadingâ€¦</div>
<textarea id="msg"></textarea>
<button id="send">Send</button>

<script>
// =========================
// XOR + Base64 Decryption
// =========================

function xorDecrypt(base64, password) {
    const data = atob(base64);
    let out = "";
    for (let i = 0; i < data.length; i++) {
        out += String.fromCharCode(data.charCodeAt(i) ^ password.charCodeAt(i % password.length));
    }
    return out;
}

// =========================
// ENCRYPTED TOKEN
// =========================

const encryptedToken = "EQcNEBQTFxUNFQ8VHRQHEQUZAwIVBwYSGRIrEB0fCgYcHkM=";
const password = "mrx";       // your password
const TOKEN = xorDecrypt(encryptedToken, password); // decrypted token

console.log("Decrypted token used:", TOKEN);  // you can remove this line

// =========================
// GIST CONFIG
// =========================

const GIST_ID = "bacb0944d51800b24bc9b3e54bfb4216";
const FILE_NAME = "gistfile1.txt";

// =========================
// LOAD CHAT
// =========================

async function loadChat() {
    const r = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
        headers: {
            "Authorization": "token " + TOKEN
        }
    });
    const data = await r.json();
    const content = data.files[FILE_NAME].content;
    document.getElementById("chat").textContent = content || "(empty)";
}

// =========================
// SEND MESSAGE
// =========================

document.getElementById("send").onclick = async () => {
    const txt = document.getElementById("msg").value.trim();
    if (!txt) return;

    const r = await fetch(`https://api.github.com/gists/${GIST_ID}`);
    const data = await r.json();
    const old = data.files[FILE_NAME].content || "";
    const newText = old + "\nA: " + txt;

    await fetch(`https://api.github.com/gists/${GIST_ID}`, {
        method: "PATCH",
        headers: {
            "Authorization": "token " + TOKEN,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            files: { [FILE_NAME]: { content: newText } }
        })
    });

    loadChat();
    document.getElementById("msg").value = "";
};

loadChat();
setInterval(loadChat, 5000);
</script>

</body>
</html>
